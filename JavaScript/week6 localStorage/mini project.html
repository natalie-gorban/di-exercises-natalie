<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
<h2>Local Storage - Java sctipt</h2>
<style media='screen'>
    input {
        padding: 7px;
        height: 40px;
    }

   fieldset {
       margin-bottom: 20px;

   }
</style>


<body>
<form id='insert_form'>
    <fieldset>
        <legend>Insert Data</legend>
        <label for="name">Name:</label><input id="name" type="text">
        <br>
        <label for="description">Description:</label><input id="description" type="text">
        <br>
        <label for="start_date">Start Date:</label><input id="start_date" type="date">
        <br>
        <label for="end_date">End Date:</label><input id="end_date" type="date">
        <br>
        <label for="status">Status(done or not):</label><input id="status" type="checkbox">
        <br><br>
        <input id="reset" type="reset">
        <button type='button' id='btnInsert'>Insert Data</button>
    </fieldset>
</form>


<fieldset>
    <legend>Last Added ToDo Task</legend>
    <div id='output'></div>
</fieldset>
<script type='text/javascript'>
    const nameInput = document.getElementById('name')
    const descriptionInput = document.getElementById('description')
    const startDateInput = document.getElementById('start_date')
    const endDateInput = document.getElementById('end_date')
    const statusInput = document.getElementById('status')

    const btnInsert = document.getElementById('btnInsert')

    const outputDiv = document.getElementById('output')

    btnInsert.onclick = function () {
        console.log(`input parameters:\n  name: ${nameInput.value}\n  description: ${descriptionInput.value}\n  start date: ${startDateInput.value}\n  end date: ${endDateInput.value}\n  status: ${statusInput.value}`)
        let dateDiff = Date.parse(endDateInput.value) - Date.parse(startDateInput.value)
        console.log(`date diff: ${dateDiff}`)
        if (dateDiff <= 0){
            alert("end date cannot be earlier than start date")
        } else if (nameInput.value == '' || descriptionInput.value == '' || startDateInput.value == '' || endDateInput.value == ''){
            alert("name or description or start date or end date cannot be empty")
        } else {
            let now = new Date().getTime()
            let todoObject = localStorage.getItem('todo')
            let todoMap = todoObject == null ? {} : JSON.parse(todoObject)
            todoMap[now] = {
                'name': nameInput.value,
                'description': descriptionInput.value,
                'start_date': startDateInput.value,
                'end_date': endDateInput.value,
                'status': statusInput.value
            }
            outputDiv.innerHTML = `<p>name: ${nameInput.value}</p><p>description: ${descriptionInput.value}</p><p>start_date: ${startDateInput.value}</p><p>end_date: ${endDateInput.value}</p><p>status: ${statusInput.value}</p>`
            console.log(todoMap)
            localStorage.setItem('todo', JSON.stringify(todoMap))
        }
    }

</script>




<div id="current_date_time_block"></div>

<script type="text/javascript">

function zero_first_format(value)
    {
        if (value < 10)
        {
            value='0'+value;
        }
        return value;
    }
    function date_time()
    {
        var current_datetime = new Date();
        var day = zero_first_format(current_datetime.getDate());
        var month = zero_first_format(current_datetime.getMonth()+1);
        var year = current_datetime.getFullYear();
        var hours = zero_first_format(current_datetime.getHours());
        var minutes = zero_first_format(current_datetime.getMinutes());
        var seconds = zero_first_format(current_datetime.getSeconds());

        return day+"."+month+"."+year+" "+hours+":"+minutes+":"+seconds;
    }

    /* выводим текущую дату и время на сайт в блок с id "current_date_time_block" */
    document.getElementById('current_date_time_block').innerHTML = date_time();


</script>

<!-- <script src='main.js'></script> -->
</body>
</html>